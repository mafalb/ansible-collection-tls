# vim: set ft=yaml ts=2 expandtab:
---

- name: OS specific config
  import_role:
    name: mafalb.tls.cfg
 
- name: assertions
  assert:
    that:
    - key_dir|default(tls_default_key_dir) is defined
    - alias is defined
    - key_size is defined
    - key_type in ['RSA']

- name: directory for {{ alias }} is present
  when:
  - key_dir is defined or alias|dirname != ""
  file:
    path: "{{ key_dir|default(tls_default_key_dir) }}/{{ alias|dirname }}"
    state: directory
    recurse: true

- name: ansibles dependencies are present
  import_role:
    name: mafalb.ansible.node

- name: "{{ alias }} is present"
  openssl_privatekey:
    path: "{{ key_dir|default(tls_default_key_dir) }}/{{ alias }}.key"
    size: "{{ key_size }}"
    type: "{{ key_type }}"
    backup: true

...
